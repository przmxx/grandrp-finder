<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>GrandRP RESET | PRZMX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; }
        .card { background: #111; border: 1px solid #333; padding: 10px; margin-bottom: 5px; border-radius: 5px; }
        .id-num { color: #0f5; font-weight: bold; font-size: 1.5rem; }
    </style>
</head>
<body class="p-5">

    <div class="max-w-xl mx-auto">
        <h1 class="text-2xl font-bold mb-4">GRANDRP TRACKER - RESET</h1>
        
        <div class="mb-5 flex gap-2">
            <button onclick="fetchData()" class="bg-blue-600 px-4 py-2 rounded font-bold">ODŚWIEŻ</button>
            <div id="status" class="text-yellow-500 py-2">Czekam...</div>
        </div>

        <input type="text" id="search" placeholder="Szukaj nick/id..." oninput="render()" class="w-full p-3 bg-gray-900 border border-gray-700 rounded mb-5">

        <div class="mb-2 text-gray-400 uppercase text-xs">Online: <span id="count">0</span></div>
        <div id="list"></div>
    </div>

    <script>
        let players = [];

        async function fetchData() {
            const status = document.getElementById('status');
            status.innerText = "POBIERANIE...";
            status.style.color = "yellow";

            const target = "https://servers-frontend.fivem.net/api/servers/single/8rml8v";
            const proxy = "https://api.allorigins.win/raw?url=";

            try {
                const res = await fetch(proxy + encodeURIComponent(target) + "&t=" + Date.now());
                const data = await res.json();

                if (data?.Data?.players) {
                    players = data.Data.players.sort((a,b) => a.id - b.id);
                    status.innerText = "GOTOWE";
                    status.style.color = "green";
                    render();
                } else {
                    status.innerText = "BŁĄD DANYCH";
                    status.style.color = "red";
                }
            } catch (e) {
                status.innerText = "BŁĄD POŁĄCZENIA";
                status.style.color = "red";
                console.error(e);
            }
        }

        function render() {
            const val = document.getElementById('search').value.toLowerCase();
            const container = document.getElementById('list');
            container.innerHTML = "";
            
            const filtered = players.filter(p => 
                p.name.toLowerCase().includes(val) || p.id.toString().includes(val)
            );

            document.getElementById('count').innerText = players.length;

            filtered.forEach(p => {
                const div = document.createElement('div');
                div.className = "card flex justify-between items-center";
                div.innerHTML = `
                    <div>
                        <div class="text-xs text-gray-500">NICK</div>
                        <div class="font-bold">${p.name}</div>
                    </div>
                    <div class="id-num">${p.id}</div>
                `;
                container.appendChild(div);
            });
        }

        // Start
        fetchData();
        setInterval(fetchData, 30000);
    </script>
</body>
</html>
